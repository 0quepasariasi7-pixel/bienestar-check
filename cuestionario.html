<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Essencia Vital | Cuestionario de Origen</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        :root { --primary: #6366F1; --accent: #2DD4BF; --bg: #0F172A; }
        body { background: var(--bg); font-family: 'Plus Jakarta Sans', sans-serif; color: white; overflow-x: hidden; }
        .card { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); }
        .btn-option { background: rgba(255,255,255,0.05); transition: all 0.3s; border: 1px solid rgba(255,255,255,0.1); }
        .btn-option:hover { background: rgba(99, 102, 241, 0.2); border-color: var(--primary); transform: translateX(5px); }
        .progress-bar { transition: width 0.5s ease-in-out; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-6">

    <!-- Barra de Progreso Superior -->
    <div class="fixed top-0 left-0 w-full h-1 bg-slate-800">
        <div id="progress" class="h-full bg-indigo-500 progress-bar" style="width: 0%"></div>
    </div>

    <div id="quiz-container" class="w-full max-w-xl">
        <!-- Contenido dinÃ¡mico -->
    </div>

    <script>
        // NUEVA URL DE IMPLEMENTACIÃ“N PROPORCIONADA (VersiÃ³n 3 - 19 dic 2025)
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw5LotdMBfPkpfTMTtvy_n3wXUHE7TJZKc9Zhwum7-8_ClMwpGbOD2iRQGTalNcaWZrDg/exec";
        const NO_DATA = "No aplica";

        const state = {
            step: 0,
            answers: {
                Fecha: '', Edad: '', Sexo: '', Trabajo: '', Pantalla: '', 
                Energia: '', SueÃ±o: '', Estres: '', Foco: '', 
                Estres_Nocturno: NO_DATA, Cambios_Humor: NO_DATA, 
                Fatiga_Mental: NO_DATA, Lagunas_Mentales: NO_DATA, 
                Recuperacion: NO_DATA, Molestias_Fisicas: NO_DATA, Email: ''
            }
        };

        const questions = [
            { id: 'Edad', title: 'Â¿CuÃ¡l es tu rango de edad?', options: ['18-34', '35-44', '45-60', 'Mas 60'] },
            { id: 'Sexo', title: 'Perfil BiolÃ³gico', options: ['Femenino', 'Masculino', 'No definido'] },
            { id: 'Trabajo', title: 'Nivel de actividad laboral', options: ['Sedentario', 'Mixto', 'Fisico'] },
            { id: 'Pantalla', title: 'ExposiciÃ³n diaria a pantallas', options: ['Baja', 'Media', 'Alta'] },
            { id: 'Energia', title: 'Nivel de energÃ­a actual (1-5)', options: ['1', '2', '3', '4', '5'] },
            { id: 'SueÃ±o', title: 'Calidad de tu descanso', options: ['Excelente', 'Bueno', 'Regular', 'Malo'] },
            { id: 'Estres', title: 'Nivel de estrÃ©s percibido (1-5)', options: ['1', '2', '3', '4', '5'] },
            { id: 'Foco', title: 'Claridad y enfoque mental', options: ['Alto', 'Medio', 'Bajo'] },
            { id: 'Estres_Nocturno', title: 'Â¿Sufres de mente rumiante por la noche?', options: ['Si', 'No'] },
            { id: 'Cambios_Humor', title: 'Â¿Experimentas cambios de humor repentinos?', options: ['Si', 'No'] },
            { id: 'Fatiga_Mental', title: 'Â¿Sientes fatiga mental constante?', options: ['Si', 'No'] },
            { id: 'Lagunas_Mentales', title: 'Â¿Tienes "lagunas" o falta de memoria reciente?', options: ['Si', 'No'] },
            { id: 'Recuperacion', title: 'Capacidad de recuperaciÃ³n tras esfuerzo', options: ['Rapida', 'Normal', 'Lenta'] },
            { id: 'Molestias_Fisicas', title: 'Â¿Presentas molestias fÃ­sicas o rigidez?', options: ['Si', 'No'] }
        ];

        function render() {
            const container = document.getElementById('quiz-container');
            const progress = document.getElementById('progress');
            
            if (state.step >= questions.length) {
                renderEmailCapture();
                progress.style.width = "100%";
                return;
            }

            const q = questions[state.step];
            progress.style.width = `${(state.step / questions.length) * 100}%`;

            container.innerHTML = `
                <div class="card p-8 rounded-3xl shadow-2xl animate-in fade-in slide-in-from-bottom-4 duration-500">
                    <span class="text-xs font-bold text-indigo-400 uppercase tracking-widest mb-2 block">Protocolo Origen Â· Paso ${state.step + 1}</span>
                    <h2 class="text-3xl font-extrabold mb-6 leading-tight">${q.title}</h2>
                    <div class="flex flex-col gap-3">
                        ${q.options.map(opt => `
                            <button onclick="save('${q.id}', '${opt}')" class="btn-option p-5 rounded-2xl text-left font-semibold flex justify-between items-center group">
                                <span>${opt}</span>
                                <span class="opacity-0 group-hover:opacity-100 transition-opacity">â†’</span>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function save(id, value) {
            state.answers[id] = value;
            state.step++;
            render();
        }

        function renderEmailCapture() {
            const container = document.getElementById('quiz-container');
            container.innerHTML = `
                <div class="card p-8 rounded-3xl shadow-2xl text-center">
                    <div class="w-20 h-20 bg-indigo-500/20 rounded-full flex items-center justify-center mx-auto mb-6">
                        <span class="text-3xl">ðŸ§¬</span>
                    </div>
                    <h2 class="text-3xl font-extrabold mb-4">Mapeo Finalizado</h2>
                    <p class="text-slate-400 mb-6 leading-relaxed">Ingresa tu email para recibir el reporte personalizado de tu CÃ³digo Origen.</p>
                    <input type="email" id="email" placeholder="tu@email.com" class="w-full p-4 bg-black/30 border border-white/10 rounded-xl mb-4 text-white outline-none focus:border-indigo-500 transition-colors">
                    <button onclick="finish()" id="submit-btn" class="w-full p-4 bg-indigo-600 hover:bg-indigo-500 rounded-xl font-bold transition-all shadow-lg shadow-indigo-500/20">
                        Obtener Mi AnÃ¡lisis â†’
                    </button>
                </div>
            `;
        }

        async function finish() {
            const email = document.getElementById('email').value;
            const btn = document.getElementById('submit-btn');
            if (!email.includes('@')) return;
            
            btn.disabled = true;
            btn.innerHTML = "Sincronizando vectors...";
            
            state.answers.Email = email;
            state.answers.Fecha = new Date().toLocaleString('es-ES');

            try {
                const params = new URLSearchParams(state.answers).toString();
                // EnvÃ­o mediante POST no-cors para evitar bloqueos del navegador
                await fetch(`${SCRIPT_URL}?${params}`, { method: 'POST', mode: 'no-cors' });
                
                document.getElementById('quiz-container').innerHTML = `
                    <div class="card p-12 rounded-3xl text-center">
                        <div class="text-5xl mb-6">âœ¨</div>
                        <h2 class="text-3xl font-extrabold text-white mb-4">SincronizaciÃ³n Exitosa</h2>
                        <p class="text-slate-400">Tus datos han sido procesados. El informe llegarÃ¡ a <b>${email}</b> en breve.</p>
                        <button onclick="window.location.href='index.html'" class="mt-8 px-6 py-2 bg-slate-800 rounded-lg text-sm font-bold hover:bg-slate-700 transition-colors">
                            Volver al Panel
                        </button>
                    </div>
                `;
            } catch (e) {
                console.error(e);
                btn.disabled = false;
                btn.innerHTML = "Error de conexiÃ³n. Reintentar.";
            }
        }

        render();
    </script>
</body>
</html>
